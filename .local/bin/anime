#!/usr/bin/python
import json
import subprocess
import argparse
from pathlib import Path

CONFIG_FILE = Path("~/.config/niri/extend/animations.kdl").expanduser()

ANIME_DEFAULT = "default"
ANIME_COFFEE = "coffee"
ANIME_CHILL = "chill"
ANIME_SPRING = "spring"
ANIMES = [
    ANIME_COFFEE,
    ANIME_CHILL,
    ANIME_SPRING,
]
KDL_NAME_MAP = {
    ANIME_COFFEE: "coffee-animations",
    ANIME_CHILL: "chill-animations",
    ANIME_SPRING: "spring-animations",
}


def send_toast(anime: str):
    data = json.dumps(
        {
            "title": "Animation",
            "body": f"{anime.title()}",
        }
    )
    subprocess.run(f"qs -c noctalia-shell ipc call toast send '{data}'", shell=True)


def get_config_line(anime: str, enable: bool) -> str:
    return f'{"//" if not enable else ""}include "./{anime}.kdl"'


def set_animation(anime: str):
    if anime == ANIME_DEFAULT:
        with open(CONFIG_FILE.absolute(), "w") as config:
            config.write("")
        send_toast(anime)
        return

    if anime not in ANIMES:
        return

    with open(CONFIG_FILE, "w") as config:
        config.write(f'include "./{anime}-animations.kdl";')

    send_toast(anime)


parser = argparse.ArgumentParser(description="Set Niri animations.")
parser.add_argument(
    "animation",
    help=f"Available: {', '.join([ANIME_DEFAULT] + ANIMES)}",
)
args = parser.parse_args()

set_animation(args.animation)
